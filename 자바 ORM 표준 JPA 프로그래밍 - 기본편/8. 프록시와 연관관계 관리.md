## 8. 프록시와 연관관계 관리

#### 프록시

프록시가 필요한 이유

member를 통해 team을 가져와야 하는 경우 DB에서 member를 조회할 때 team을 함께 조회하면 편리할 것이다.

하지만 member만 필요한 경우에는 team의 정보까이 함께 가져오면 손해!

<br/>

**🍀 프록시 기초**

em.find() : DB를 통해 실제 엔티티 객체 조회

em.getReference() : DB 조회를 미루는 가짜(프록시) 엔티티 조회 ---> 실제로 쿼리가 나가지 않지만 객체는 조회됨

```java
Member findMember = em.getReference(Member.class, member.getId()); // 쿼리 안나감
System.out.println(findMember.getId()); // 쿼리 안나감, 위에 정보 있기 때문에
System.out.println(findMember.getUsername()); // 쿼리 나감
```

<br/>

**🍀 프록시 특징**

* Hibernate가 임의로 실제 클래스를 상속 받아서 프록시 클래스를 만든다.
* 실제 클래스와 겉 모양이 같다.
* 사용하는 입장에서는 진짜 객체인지 구분하지 않고 사용하면 된다.

![image](https://user-images.githubusercontent.com/64277114/188796245-52083c10-a545-4d15-aa3f-dd5c652ae3f4.png)

<br/>

* 프록시 객체는 처음 사용할 때 한 번만 초기화

* 프록시 객체를 초기화 할 때, 실제 엔티티로 바뀌는 것이 아님!!!! 초기화가 되면 프록시 객체를 통해 실제 엔티티에 접근 가능하게 되는 것

* **<u>프록시 객체는 원본 엔티티를 상속받으므로 타입 체크시 == 가 아니라 instance of 사용해야 함</u>**

* 영속성 컨텍스트에 찾는 엔티티가 이미 있으면 em.getReference()를 호출해도 실제 엔티티 반환

* 영속성 컨텍스트의 도움을 받을 수 없는 준영속 상태일때, 프록시를 초기화 하면 문제 발생

  (org.hibernate.LazyInitializationException)

<br/>

**🍀 프록시 객체의 초기화**

```java
Member member = em.getReference(Member.class, “id1”);
member.getName();
```

![image](https://user-images.githubusercontent.com/64277114/188796384-f51a64a8-68f3-4577-bbc4-40094ac07b20.png)

<br/>

✔ 모든 이미지 출처 - 강의자료