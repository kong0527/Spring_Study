# 2. JPA ì‹œì‘

#### pom.xml ì„¤ì •

[ì—¬ê¸°](https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-dependency-versions.html#dependency-versions) ì—ì„œ Spring Bootì˜ dependency ë“¤ì— ëŒ€í•œ versionì„ í™•ì¸í•  ìˆ˜ ìˆìŒ!

h2 ë°ì´í„°ë² ì´ìŠ¤ ë²„ì „ì€ ë‚´ê°€ ë‹¤ìš´ë°›ì€ ê²ƒê³¼ ê°™ì€ ë²„ì „ì´ì–´ì•¼ í•¨

<br/>

#### JPA ì„¤ì •í•˜ê¸°

JPAë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” persistence.xml íŒŒì¼ì´ í•„ìš”í•˜ë‹¤. (META-INF í´ë” ë°‘ì— ìƒì„±)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<persistence version="2.2"
xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd">
<persistence-unit name="hello"> // ë³´í†µ ë°ì´í„°ë² ì´ìŠ¤ í•˜ë‚˜ë§ˆë‹¤ ë§Œë“¤ì–´ì„œ ì´ë¦„ì„ ë¶™ì—¬ì¤Œ
<properties>
<!-- í•„ìˆ˜ ì†ì„± --> // DB ì ‘ê·¼ì •ë³´
<property name="javax.persistence.jdbc.driver" value="org.h2.Driver"/>
<property name="javax.persistence.jdbc.user" value="sa"/>
<property name="javax.persistence.jdbc.password" value=""/>
<property name="javax.persistence.jdbc.url" value="jdbc:h2:tcp://localhost/~/test"/>
<property name="hibernate.dialect" value="org.hibernate.dialect.H2Dialect"/>
    // JPAëŠ” íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì— ì¢…ì†ë˜ì§€ ì•ŠëŠ”ë‹¤.
    // ê·¸ë ‡ê¸° ë•Œë¬¸ì— ê·¸ DBì—ì„œë§Œ ìˆëŠ” ê³ ìœ í•œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ëª…ì‹œí•´ì£¼ì–´ì•¼ í•œë‹¤.
<!-- ì˜µì…˜ -->
<property name="hibernate.show_sql" value="true"/>
<property name="hibernate.format_sql" value="true"/>
<property name="hibernate.use_sql_comments" value="true"/>
<!--<property name="hibernate.hbm2ddl.auto" value="create" />-->
</properties>
</persistence-unit>
</persistence>
```

<br/>

#### JPA ë™ì‘ í™•ì¸

```java
public class JpaMain {

    public static void main(String[] args) {
        // persistence.xml ì—ì„œ ì ì€ persistence-unit name
        EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");

        EntityManager em =  emf.createEntityManager();

        EntityTransaction tx = em.getTransaction();
        tx.begin();

        try {
            Member member = new Member();
            member.setId(2L);
            member.setName("HelloB");

            // DBì— member ì €ì¥
            em.persist(member);

            tx.commit();
        } catch (Exception e) {
            tx.rollback();
        } finally {
            em.close(); // ì‚¬ìš© ë‹¤ í•˜ë©´ ë‹«ì•„ì£¼ëŠ”ê±° ì¤‘ìš”!!
        }

        emf.close(); // ì• í”Œë¦¬ì¼€ì´ì…˜ ì™„ì „íˆ ëë‚˜ë©´ ë‹«ì•„ì¤˜ì•¼ í•¨
    }
}
```

âœ EntityManagerFactoryëŠ” application ë¡œë”© ì‹œì ì— í•˜ë‚˜ë§Œ ë§Œë“¤ì–´ì•¼ í•œë‹¤. 

âœ applicationì´ ì™„ì „íˆ ì¢…ë£Œë˜ë©´ ê¼­ ë‹«ì•„ì¤˜ì•¼ í•¨ â—

âœ JPAì—ì„œ ëª¨ë“  ë°ì´í„°ë¥¼ ë³€ê²½í•˜ëŠ” ì‘ì—…ì€ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ì´ë£¨ì–´ì ¸ì•¼ í•œë‹¤.

âœ ì´ íŠ¸ëœì­ì…˜ ë‹¨ìœ„ ë§ˆë‹¤ EntityManagerê°€ í•„ìš”í•˜ë‹¤. (ìŠ¤ë ˆë“œê°„ì— ê³µìœ  X) -> DB ì»¤ë„¥ì…˜ í•˜ë‚˜ ë°›ëŠ”ë‹¤ê³  ìƒê°í•˜ë©´ ë¨

<br/>

![image](https://user-images.githubusercontent.com/64277114/120916247-72c01980-c6e3-11eb-8311-3d9157ef6a36.png)

pom.xmlì— ì ì€ ì˜µì…˜ ë•Œë¬¸ì— ì½˜ì†” ì°½ì—ì„œ ì¿¼ë¦¬ë¥¼ ë³¼ ìˆ˜ ìˆìŒ

![image](https://user-images.githubusercontent.com/64277114/120916656-d0556580-c6e5-11eb-9cf2-dda3ac37dab7.png)

DBì— ë°ì´í„°ê°€ ì˜ ì €ì¥ëœ ê²ƒì„ í™•ì¸ ğŸ˜
